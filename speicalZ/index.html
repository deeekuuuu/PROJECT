<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Floating Message</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Poppins", system-ui, sans-serif;
  background: #f0ddd6;
  min-height: 100vh;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  -webkit-tap-highlight-color: transparent;
}

/* Message Area */
.message-wrapper {
  text-align: center;
  width: 100%;
  max-width: 420px;
  padding: 0 16px env(safe-area-inset-bottom);
  position: relative;

  /* Stable + Scrollable Area */
  min-height: 130px;
  max-height: 45vh;
  overflow-y: hidden;

  display: flex;
  align-items: center;
  justify-content: center;
}

.message {
  font-size: clamp(20px, 5.5vw, 28px);
  line-height: 1.8;
  white-space: pre-line;
  letter-spacing: 0.3px;
  padding: 0 12px;

  /* Reserve Space */
  min-height: 2.6em;

  will-change: opacity, transform;
}

/* Skip Button */
.skip-btn {
  position: fixed;
  top: env(safe-area-inset-top, 12px);
  right: 12px;
  background: rgba(0,0,0,0.7);
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 22px;
  font-size: 14px;
  cursor: pointer;
  z-index: 20;
}

/* Name Popup */
#nameOverlay {
  position: fixed;
  inset: 0;
  display: none;
  justify-content: center;
  align-items: center;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(6px);
  z-index: 10;
  padding: 16px;
}

.popup {
  background: rgba(255,255,255,0.12);
  padding: 28px 24px;
  border-radius: 20px;
  width: 100%;
  max-width: 320px;
  text-align: center;
}

.popup input {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  outline: none;
  font-size: 16px;
  margin-top: 10px;
}

.popup button {
  margin-top: 18px;
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 12px;
  background: #ffffff;
  color: #000;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
}

/* Option Boxes */
.option-box {
  position: relative;
  padding: 18px;
  border-radius: 16px;
  background: rgba(255,255,255,0.7);
  font-size: 18px;
  cursor: pointer;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.7s ease;
  text-align: center;
  overflow: hidden;
}

.option-box::before {
  content: "";
  position: absolute;
  top: -50%;
  left: -60%;
  width: 50%;
  height: 200%;
  background: linear-gradient(
    120deg,
    transparent,
    rgba(255,255,255,0.7),
    transparent
  );
  transform: skewX(-20deg);
  animation: shine 3.5s infinite;
}

@keyframes shine {
  0% { left: -60%; }
  60% { left: 120%; }
  100% { left: 120%; }
}
</style>
</head>

<body>

<!-- Skip -->
<button class="skip-btn" id="skipBtn" onclick="skipIntro()">Skip</button>

<div class="message-wrapper" id="wrapper">
  <div class="message" id="message"></div>
</div>

<!-- Continue Button -->
<button id="continueBtn" style="display:none;margin-top:20px;padding:12px 24px;border:none;border-radius:20px;background:#000;color:#fff;font-size:15px;cursor:pointer;">Next</button>

<!-- Name Popup -->
<div id="nameOverlay">
  <div class="popup">
    <div style="font-size:18px;margin-bottom:10px;">Enter your name</div>
    <input id="nameInput" type="text" placeholder="Your name" />
    <button onclick="saveName()">Continue</button>
  </div>
</div>

<script>

const messages = [
  "Welcome to my space.",
  "No boxes. No frames.",
  "Just words, floating freely.",
  "One thought at a time."
];

const target = document.getElementById("message");
const skipBtn = document.getElementById("skipBtn");
const wrapper = document.getElementById("wrapper");
const continueBtn = document.getElementById("continueBtn");

let index = 0;
let skipped = false;
let currentTimeout = null;
let afterName = false; // switch behavior after name is entered

/* Swipe Skip */
let touchStartX = 0;

wrapper.addEventListener("touchstart", e => {
  touchStartX = e.touches[0].clientX;
});

wrapper.addEventListener("touchend", e => {
  const dx = e.changedTouches[0].clientX - touchStartX;
  if (Math.abs(dx) > 80) skipIntro();
});

/* Animate Text (Typewriter + Skip Support) */
function animateText(text, onDone){

  if(skipped) return;

  clearTimeout(currentTimeout);

  target.style.opacity = 1;
  target.style.transform = "none";
  target.style.transition = "none";

  // Before name: keep previous text
// After name: start fresh for each message
if(afterName){
  target.textContent = "";
}

  let i = 0;
  const speed = 40; // typing speed

  function type(){

    if(skipped){
      target.textContent += text.slice(i);
      if(onDone) onDone();
      return;
    }

    if(i < text.length){
      target.textContent += text.charAt(i);
      i++;

      // Auto scroll when long
      target.parentElement.scrollTop = target.parentElement.scrollHeight;

      currentTimeout = setTimeout(type, speed);
    }
    else{
      currentTimeout = setTimeout(()=>{
        if(onDone) onDone();
      }, 700);
    }
  }

  type();
}

/* Show Messages */
function showMessage(){

  if(skipped) return;

  if(index >= messages.length){
    skipBtn.style.display="none";
    showContinueBtn();
    return;
  }

  animateText(messages[index],()=>{
    index++;
    showMessage();
  });
}

/* Skip */
function skipIntro(){

  skipped = true;
  clearTimeout(currentTimeout);

  target.textContent="";
  skipBtn.style.display="none";

  showNamePopup();
}

function showContinueBtn(){
  continueBtn.style.display = "inline-block";
  continueBtn.onclick = ()=>{
    continueBtn.style.display = "none";
    showNamePopup();
  };
}

/* Name */
function showNamePopup(){
  document.getElementById("nameOverlay").style.display="flex";
}

function saveName(){

  // Switch to after-name mode
  afterName = true;

  // Clear old messages so new typing starts fresh
  target.textContent = "";


  const name = document.getElementById("nameInput").value.trim();
  if(!name) return;

  localStorage.setItem("userName",name);

  document.getElementById("nameOverlay").style.display="none";

  skipped = false;
  clearTimeout(currentTimeout);

  const nameMessages = [
    `Hi ${name}.`,
    "I’m glad you’re here.",
    "Let’s continue."
  ];

  let i = 0;

  function showNameMessage(){

    if(i >= nameMessages.length){
      showOptions();
      return;
    }

    animateText(nameMessages[i],()=>{
      i++;
      showNameMessage();
    });
  }

  showNameMessage();
}

/* Options */
function showOptions(){

  target.innerHTML="";
  target.style.opacity=1;
  target.style.transform="none";

  const options = document.createElement("div");

  options.style.display="flex";
  options.style.flexDirection="column";
  options.style.gap="18px";
  options.style.marginTop="20px";

  const pages = [

    {
      label:"Enscribe",
      link:"quotes.html",
      lines:[""]
    },

    {
      label:"Songs",
      link:"songs.html",
      lines:[""]
    },

    {
      label:"Lines",
      link:"lines.html",
      lines:[""]
    }

  ];

  pages.forEach((p,i)=>{

    const box=document.createElement("div");
    box.className="option-box";

    box.innerHTML=`<strong>${p.label}</strong><div class='inner'></div>`;

    const inner=box.querySelector(".inner");

    inner.style.fontSize="14px";
    inner.style.marginTop="8px";
    inner.style.opacity=0.8;

    options.appendChild(box);

    setTimeout(()=>{

      box.style.opacity=1;
      box.style.transform="translateY(0)";
      animateLines(inner,p.lines);

    },i*350);

    box.onclick=()=>window.location.href=p.link;

  });

  target.appendChild(options);
}

/* Animate Lines */
function animateLines(container,lines){

  let i=0;
  container.textContent="";

  function nextLine(){

    if(i>=lines.length) return;

    const div=document.createElement("div");

    div.textContent=lines[i];
    div.style.opacity=0;
    div.style.transform="translateX(18px)";
    div.style.transition="all .45s ease";

    container.appendChild(div);

    requestAnimationFrame(()=>{
      div.style.opacity=1;
      div.style.transform="translateX(0)";
    });

    i++;
    setTimeout(nextLine,420);
  }

  nextLine();
}

/* Start */
showMessage();

</script>

</body>
</html>
